<%- include('../partials/user-header.ejs') %>

<div class="container mt-4 text-center">
    <h2><%= currentUser.username %> : Cart</h2>
    <table class="table text-start">
        <% if(currentUser.cart.length === 0) { %>
            <hr class="dropdown-divider mt-5">
            <h3 class="mt-3">Nothing in a Cart please go Shopping <a href="/user/home" class="btn btn-warning">Go to Home page</a></h3>
        <% } else { %>
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Image</th>
            <th scope="col">Name</th>
            <th scope="col">Price</th>
            <th scope="col">Quantity</th>
            <th scope="col">Total price</th>
            <th scope="col"></th>
          </tr>
        </thead>
        <tbody>
        <% let i = 0, allP = 0 %>
        <% currentUser.cart.forEach(function(product){ %>
        <% i += 1 %>
          <tr>
            <th><%= i %></th>
            <td><img src="<%= product.pImg %>" alt="<%= product.pName %>" style="width:100px"></td>
            <td><%= product.pName %></td>
            <td><%= product.pPrice %></td>
            <td><%= product.pQty %></td>
            <td><%= product.pPrice * product.pQty %></td>
            <% allP += product.pPrice * product.pQty %>
            <td><a href="/user/cart/delete/<%= product.pID %>" class="btn btn-danger">Delete</a></td>
          </tr>
        <% }) %>
        </tbody>
      </table>
      <div>
          <div class="float-end text-end">
            <h4>Total price = à¸¿ <%= allP %></h4>
            <form onsubmit="return confirm('Confirm Buy all Product in Cart?');" action="/user/cart/buy" method="GET">
                <button class="btn btn-warning fw-bolder">Buy</button>
            </form>
          </div>
      </div>
      <% } %>
</div>

<%- include('../partials/user-footer.ejs') %>